# 手軽に遊べるブラックジャックゲームです

## ゲームの遊び方

1. 「blackjack.rb」を実行します
1. 何人で遊ぶか選びます
1. プレイヤーの人数（実際に動かす人数）を選択します。
1. 参加者全員に 2 枚ずつカードが配られ、配られたカードが表示されますが、ディーラーの 2 枚目のカードはふせられています。
1. 最初にあなたのターンがきます。現在の手札と合計点が表示されるので、カードを引くかどうかを選択します。
1. 「引く」を選択し続ける限りカードを引き続けますが、合計点が 21 点もしくは 21 点をオーバー（バースト）した時点で引けなくなります。
1. あなたのターンが終了すると次のプレイヤーまたは CPU のターンとなります。
1. あなた以外がプレイヤーだった場合はあなたと同様の操作となります。
1. CPU は合計点が 17 点以上になるまでカードを引き続けます。
1. プレイヤー、CPU 全員のターンが終わり全員がバーストだった場合、この時点でディーラーの勝利が確定してゲームは終了します。
1. 上記以外の場合ディーラーのターンとなり、ディーラーの 2 枚目のカードと合計点が表示されます。
1. ディーラーは合計点が 17 点以上になるまでカードを引き続けます。
1. ディーラーのターンが終了すると、ディーラーの合計点とそれぞれの合計点が比較され、勝敗が表示されます。
1. 勝敗が表示されたらゲームは終了します。

## 裏側の処理の流れ

### 1.blackjack.rb を実行

### 2.Game クラスをインスタンス化

- ゲームの準備を行う Preparate クラスをインスタンス化
  - preparate オブジェクトが遊ぶ人数、プレイヤーの人数を確定
- player_set メソッドを呼び出して player オブジェクトを配列で受け取る
  - Player クラスの create_player メソッドの引数に、確定したプレイヤーの人数を渡して呼び出す
    - create_player メソッドは引数で受け取った人数分の Player オブジェクトを生成
      ※生成されたオブジェクトは名前と手札をプロパティとして持ち、手札と合計点を表示させる show_hand メソッド、更にカードを引くか引かないかを選択する choose メソッド、手札の合計点を出す total メソッドを持つ
    - 生成したオブジェクトを配列にして返す
- cpu_set メソッドを呼び出して cpu オブジェクトを配列で受け取る
  - Cpu クラスの create_cpu メソッドの引数に、遊ぶ人数からプレイヤーの人数を引いた数を渡して呼び出す
    - create_cpu メソッドの役割は player_set メソッドと同じなので割愛
      ※生成されたオブジェクトは合計点に応じて自動でカードを引き続ける auto_hit メソッドを持つ
- dealer_set メソッドを呼び出す
  - Dealer クラスをインスタンス化
    ※dealer オブジェクトはカードを 2 枚配る deal_card メソッド、自らカードを 2 枚引く draw_card メソッド、「引く」選択をしたプレイヤー、CPU に対してカードを配る hit_card メソッドを持つ
- create_deck メソッドを呼び出して card オブジェクトを配列で受け取る
  - Deck クラスのインスタンス化
    - Card クラスをマークと数字を組み合わせの数だけインスタンス化して配列に追加する
      ※Card クラスはマークと数字を引数で受け取り、それを繋げてカードの種類を表す kind と、数字に応じて決まった点数 point という 2 つのプロパティを持つ
    - card オブジェクトが入った配列をシャッフルして返す

### 3.game オブジェクトの start メソッドを呼び出す

- 「ブラックジャックを開始します。」が表示される
- dealer オブジェクトの deal_card メソッドに player オブジェクトが入った配列と deck オブジェクトを引数で渡して呼び出す
  - 引数で渡ってきた player オブジェクトの数だけ deck オブジェクトの draw メソッドを呼び出す
    - draw メソッドは deck から card オブジェクトを 1 つ取り出して返す
  - 返ってきた card オブジェクトを表示する
- dealer オブジェクトの deal_card メソッドに cpu オブジェクトが入った配列と deck オブジェクトを引数で渡して呼び出す
  ※以下上記と同じなので割愛
- dealer オブジェクトの deal_card メソッドに deck オブジェクトを引数で渡して呼び出す
  ※dealer 自身のメソッドなので dealer オブジェクトを渡す必要はない、挙動は上記と同じなので割愛

### 4.game オブジェクトの player_turn メソッドを呼び出す

- player オブジェクトの数だけ実行
  - show_hand メソッドを呼び出す
    - show_hand メソッドの中で更に total メソッドを呼び出し、手札と合計点を画面に出力する
      ※合計点を返す
  - choose メソッドを呼び出す
    - 最初のみ、2 枚の合計が 21 点だった場合ブラックジャックを宣言
    - 2 回目移行、合計点が、21 点を越えたらバーストを宣言
    - 合計が 21 点未満である限り引くか引かないかを選択でき、その選択を返す
  - choose メソッドが'引く'を返してきたら dealer オブジェクトの hit_card メソッドの引数に deck オブジェクトと player オブジェクトを渡して呼び出す
    - deck オブジェクトの draw メソッドを呼び出し、player の hand プロパティに card オブジェクトを 1 つ追加する
    - いま引いたカードを表示させる
  - 合計点が 21 点未満である限り choose メソッドを繰り返す
  - 合計が 21 点になる、21 点を超える、引かないを選択することでプレイヤーのターンが終了
  - ターン終了時に合計点が 21 点を越えていなければ burst_check プロパティに'ok'が入る

### 5.game オブジェクトの cpu_turn メソッドを呼び出す

- cpu オブジェクトの数だけ実行
  - show_hand メソッドについては player_turn と同じ挙動なので割愛
  - auto_hit メソッドを呼び出す
    - 最初のみ、2 枚の合計が 21 点だった場合ブラックジャックを宣言
    - 2 回目移行、合計点が、21 点を越えたらバーストを宣言
    - 合計が 17 点未満である限り true を返す
  - auto_hit メソッドが true を返してきたら dealer オブジェクトの hit_card メソッドの引数に deck オブジェクトと cpu オブジェクトを渡して呼び出す
    - 挙動は player のときと同じなので割愛
  - 合計点が 17 点未満である限り auto_hit メソッドを繰り返す
  - 合計 17 点以上になる、21 点を超えることで cpu のターンが終了
  - ターン終了時に合計点が 21 点を越えていなければ burst_check プロパティに'ok'が入る

### 6.game オブジェクトの burst_check メソッドを呼び出す

- burst_check プロパティの中身がからの場合のみ処理を継続
  ※つまりプレイヤー、CPU 全員がバーストだった場合
  - 全員がバーストしたことと、ディーラーの勝利を宣言してゲームを終了する

### 7.game オブジェクトの dealer_turn メソッドを呼び出す

- dealer の 2 枚目のカードを表示
  - show_hand メソッドについては上記と同じなので割愛
  - auto_hit メソッドについては上記と同じなので割愛
  - hit_card メソッドについては上記と同じなので割愛
    ※dealer 自身なので、引数に dealer オブジェクトを渡さない点だけ異なる
  - 合計点が 17 点未満である限り auto_hit メソッドを繰り返す
  - 合計 17 点以上になる、21 点を超えることで cpu のターンが終了

### 8.game オブジェクトの judge メソッドを呼び出す

- Judge クラスにディーラーの合計点を引数として渡してインスタンス化
  - 勝敗の基準となる dealer_score プロパティを持つ
- judge オブジェクトの result メソッドに player オブジェクトを引数として渡して呼び出す
  - player オブジェクトの数だけ処理を実行
    - ここではディーラーの点数とプレイヤーの合計点数を比較し、21 点に近い方が勝利としている
    - 同じ点数、両者ともバーストの場合は引き分けとなる
- judge オブジェクトの result メソッドに cpu オブジェクトを引数として渡して呼び出す
  - 処理の内容は上記と同じなので割愛

### 9.game オブジェクトの close メソッドを呼び出す

- 「ブラックジャックを終了します。」が表示され終了。
